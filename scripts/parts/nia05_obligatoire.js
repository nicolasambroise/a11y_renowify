
/*- -------------------------------------------------------------------------------- */
/* üó∏ NIA-05 Element Obligatoire - Th√©matique RAWeb 8
- Empty : Mise en avant des balises et paragraphes vides
*/
function check_part_05(){
	if(debug_flag) console.log("05 Element Obligatoire");

	// A. Bloc vide
	const nia05a_nodes = document.querySelectorAll('*:not(.ol-attribution) > :where(p, th, strong, em, a, q, blockquote, aside, ul, li):not([aria-hidden="true"]):not(.mapboxgl-ctrl-logo):empty');
	let nia05a_container = "";
	if(nia05a_nodes && nia05a_nodes.length > 0 && isItemsVisible(nia05a_nodes)){
	  setItemToResultList("nc","<li><a href='#' data-destination='nia05a' class='result-focus label-red'>05-A</a> : Pr√©sence de balise vide [<a href='https://accessibilite.public.lu/fr/raweb1/criteres.html#test-8-9-1' target='_blank'>RAWeb 8.9.1</a>]</li>");
	  for(let i = 0; i < nia05a_nodes.length; i++){
			if(isItemVisible(nia05a_nodes[i])){
				setItemOutline(nia05a_nodes[i],"red","nia05a","05-A");
				nia05a_container = nia05a_nodes[i].parentElement;
				nia05a_container.style.outline = "3px dotted red";
				nia05a_container.style.outlineOffset = "-2px";
			}
		}
	}

    // B. Bloc vide avec $nbsp; ou \n
	const nia05b_nodes = document.querySelectorAll('*:not(.ol-attribution):not([aria-hidden="true"]) > :where(p, th, strong, em, a, q, blockquote, aside, ul, li):not([aria-hidden="true"]):not(.mapboxgl-ctrl-logo):not(:empty)');
	let nia05b_flag = false;
	let nia05b_clean_node = "", nia05b_container = "", nia05b_lang = "";
	if(nia05b_nodes && nia05b_nodes.length > 0){
		for(let i = 0; i < nia05b_nodes.length; i++){
			if(nia05b_nodes[i].childElementCount == 0){
				nia05b_lang = nia05b_nodes[i].closest('[lang]').getAttribute('lang');
				nia05b_clean_node = sanitizeText(nia05b_nodes[i].innerText, nia05b_lang);
				if(nia05b_clean_node == "" && isItemVisible(nia05b_nodes[i])){
					setItemOutline(nia05b_nodes[i],"red","nia05b","05-B");
					nia05b_container = nia05b_nodes[i].parentElement;
					nia05b_container.style.outline = "3px dotted red";
					nia05b_container.style.outlineOffset = "-2px";
					nia05b_flag = true;
				}
			}
		}
	}
	if(nia05b_flag == true) {
	  setItemToResultList("nc","<li><a href='#' data-destination='nia05b' class='result-focus label-red'>05-B</a> : Pr√©sence de balises vides (ou avec un contenu assimilable √† vide) [<a href='https://accessibilite.public.lu/fr/raweb1/criteres.html#test-8-9-1' target='_blank'>RAWeb 8.9.1</a>]</li>");
	}
	
	// C. Doctype
	if(!only_redactor){
		const nia05c_doctype = new XMLSerializer().serializeToString(document.doctype);
		if(nia05c_doctype != "<!DOCTYPE html>"){
			setItemToResultList("dev","<li><a href='#' data-destination='nia05c' class='result-focus label-yellow'>05-C</a> : V√©rifier qu'un doctype est correctement d√©clar√© [<a href='https://accessibilite.public.lu/fr/raweb1/criteres.html#test-8-1-1' target='_blank'>RAWeb 8.1.1</a>]</li>");
		}
	}
	
	// D. Page title
	const nia05d_title = document.title;
	if(nia05d_title == ""){
		setItemToResultList("nc","<li><a href='#' data-destination='nia05d' class='result-focus label-red'>05-D</a> : V√©rifier qu'un titre de page est d√©fini [<a href='https://accessibilite.public.lu/fr/raweb1/criteres.html#test-8-5-1' target='_blank'>RAWeb 8.5.1</a>]</li>");
	}
	
	// E. Changement de sens de lecture
	const nia05e1_nodes = document.querySelectorAll('[dir]:not([dir="rtl"]):not([dir="ltr"])');
	if(nia05e1_nodes && nia05e1_nodes.length > 0 && isItemsVisible(nia05e1_nodes)){
	  setItemToResultList("nc","<li><a href='#' data-destination='nia05e1' class='result-focus label-red'>05-E</a> : V√©rifier la valeur de d√©finition du sens de lecture [<a href='https://accessibilite.public.lu/fr/raweb1/criteres.html#test-8-10-2' target='_blank'>RAWeb 8.10.2</a>]</li>");
	  setItemsOutline(nia05e1_nodes,"red","nia05e1","05-E");
	}
	
	const nia05e2_nodes = document.querySelectorAll('[dir="rtl"]');
	const nia05e2_rtl_isocode = ["ar", "ara", "arc", "ae", "ave", "egy", "he", "heb", "nqo", "pal", "phn", "sam", "syc", "syr", "fa", "per", "fas", "ku", "kur", "dv", "ha" , "khw", "ks", "pa", "ur", "yi"];
	let nia05e2_flag = false;
	let nia05e2_lang;
	if(nia05e2_nodes && nia05e2_nodes.length > 0 && isItemsVisible(nia05e2_nodes)){
	  for(let i = 0; i < nia05e2_nodes.length; i++){
		  nia05e2_lang = nia05e2_nodes[i].closest('[lang]').getAttribute('lang');
		  if (nia05e2_rtl_isocode.indexOf(nia05e2_lang) < 0) {
			  setItemOutline(nia05e2_nodes[i],"red","nia05e2","05-E");
			  nia05e2_flag = true;
		  }
	  }
	}
	if(nia05e2_flag == true){
	  setItemToResultList("nc","<li><a href='#' data-destination='nia05e2' class='result-focus label-red'>05-E</a> : Pr√©sence d'√©l√©ment avec un sens de lecture de droite vers la gauche [<a href='https://accessibilite.public.lu/fr/raweb1/criteres.html#test-8-10-2' target='_blank'>RAWeb 8.10.2</a>]</li>");
	}
	
	// F. Id dupliqu√©
	if(!only_redactor){
		const nia05f_nodes = document.querySelectorAll('[id]:not(script):not(link)');
		let nia05f_flag = false;
		let nia05f_ids = {};
		let nia05f_currentId;
		let nia05f_duplicateId = "";
		if(nia05f_nodes && nia05f_nodes.length > 0){
			for(let i = 0; i < nia05f_nodes.length; i++){
				nia05f_currentId = nia05f_nodes[i].id ? nia05f_nodes[i].id : "undefined";
				if(isNaN(nia05f_ids[nia05f_currentId])) {
					nia05f_ids[nia05f_currentId] = 0;
				}
				else{
					nia05f_flag = true;
					setItemOutline(nia05f_nodes[i],"red","nia05f","05-F");
					nia05f_duplicateId += "\""+nia05f_currentId+"\",";
				}
				nia05f_ids[nia05f_currentId]++;
			}
		}
		if(nia05f_flag == true){
		  //console.log(nia05f_ids);
		  setItemToResultList("dev","<li><a href='#' data-destination='nia05f' class='result-focus label-red'>05-F</a> : Pr√©sence d'Id dupliqu√©<span class='cy-hidden'> ("+nia05f_duplicateId+")</span> [<a href='https://accessibilite.public.lu/fr/raweb1/criteres.html#test-8-2-1' target='_blank'>RAWeb 8.2.1</a> - <a href='https://checklists.opquast.com/fr/assurance-qualite-web/chaque-identifiant-html-nest-utilise-quune-seule-fois-par-page' target='_blank'>Opquast 229</a>]</li>");
		}
	}
	
	// G. Pr√©sence de la Govbar
	const nia05g_govbar = document.querySelector('#govbar.govbar');
	if(nia05g_govbar == null || !isItemVisible(nia05g_govbar)){
		setItemToResultList("nth","<li><span class='result-focus label-yellow'>05-G</span> : Absence de la govbar, v√©rifier si ce n'est pas un oubli</li>");
	}
	
	// H. Detect double <br>
	const nia05h_nodes = document.querySelectorAll('br + br');
	let nia05h_container = "";
	let nia05h_flag = false;
	let nia05h_prev_n1, nia05h_prev_n2;
	if(nia05h_nodes && nia05h_nodes.length > 0 && isItemsVisible(nia05h_nodes)){
		for(let i = 0; i < nia05h_nodes.length; i++){
			if(isItemVisible(nia05h_nodes[i])){
				nia05h_prev_n1 = nia05h_nodes[i].previousSibling;
				nia05h_prev_n2 = nia05h_prev_n1.previousSibling;
				/*
				console.log(nia05h_nodes[i]);
				console.log(nia05h_prev_n1);
				console.log(nia05h_prev_n2);
				*/
				if(nia05h_prev_n1.nodeName == "BR"){
					setItemOutline(nia05h_nodes[i],"red","nia05h","05-H");
					nia05h_container = nia05h_nodes[i].parentElement;
					nia05h_container.style.outline = "3px dotted red";
					nia05h_container.style.outlineOffset = "-2px";
					nia05h_flag = true;
				}
				else if(nia05h_prev_n2.nodeName == "BR" && (nia05h_prev_n1.nodeName == "#text" || nia05h_prev_n1.nodeName == "#comment") && (nia05h_prev_n1.textContent == " " || nia05h_prev_n1.textContent == "")){
					setItemOutline(nia05h_nodes[i],"red","nia05h","05-H");
					nia05h_container = nia05h_nodes[i].parentElement;
					nia05h_container.style.outline = "3px dotted red";
					nia05h_container.style.outlineOffset = "-2px";
					nia05h_flag = true;
				}
			}
		}
	}
	if(nia05h_flag == true){
		  setItemToResultList("nc","<li><a href='#' data-destination='nia05h' class='result-focus label-red'>05-H</a> : Pr√©sence de multiple saut de ligne [<a href='https://accessibilite.public.lu/fr/raweb1/criteres.html#test-8-9-1' target='_blank'>RAWeb 8.9.1</a>], privil√©gier l'utilisation du composant separator</li>");
	}
	
	// I. Le code source de chaque page contient une m√©tadonn√©e qui en d√©crit le contenu. ==> Pr√©sence de meta name=description 
	const nia05i_node = document.querySelector('meta[name="description"]');
	if(nia05i_node == null || nia05i_node.content == null || nia05i_node.content == "" ){
		setItemToResultList("nth","<li><span class='result-focus label-yellow'>05-I</span> : Absence de m√©tadonn√©e qui en d√©crit le contenu [<a href='https://checklists.opquast.com/fr/assurance-qualite-web/le-code-source-de-chaque-page-contient-une-metadonnee-qui-en-decrit-le-contenu' target='_blank'>Opquast 3</a>]</li>");
	}
	
	// J. Le code source des pages contient un appel valide √† une ic√¥ne de favori.
	const nia05j_node = document.querySelector("link[rel*='icon']");
	if(nia05j_node == null || nia05j_node.getAttribute("href") == null || nia05j_node.getAttribute("href") == "" ){
		setItemToResultList("nth","<li><span class='result-focus label-yellow'>05-J</span> : Absence de Favicon [<a href='https://checklists.opquast.com/fr/assurance-qualite-web/le-code-source-des-pages-contient-un-appel-valide-a-un-icone-de-favori' target='_blank'>Opquast 99</a>]</li>");
	}

	// K. Chaque page affiche une information permettant de conna√Ætre son emplacement dans l'arborescence du site.
	if(isHomepage == false && !only_redactor){
		const nia05k_node = document.querySelector(".cmp-breadcrumb,.cmp-breadcrumb-demarches");
		if(!nia05k_node){
			setItemToResultList("nth","<li><span class='result-focus label-yellow'>05-K</span> : Absence de Fils d'Ariane [<a href='https://checklists.opquast.com/fr/assurance-qualite-web/chaque-page-affiche-une-information-permettant-de-connaitre-son-emplacement-dans-larborescence-du-site' target='_blank'>Opquast 151</a>]</li>");
		}
	}
	
	// L. Le focus clavier n'est ni supprim√© ni masqu√©.
	if(!only_redactor){
		const nia05l_node = document.querySelector("summary");
		if(nia05l_node){
			nia05l_node.addEventListener("focus", (e) => {
				//console.log(window.getComputedStyle(e.target, null).outline);
				if(window.getComputedStyle(e.target, null).outline == 0){
					setItemOutline(nia05l_node,"red","nia05l","05-L");
					setItemToResultList("dev","<li><a href='#' data-destination='nia05l' class='result-focus label-red'>05-L</a> : Le focus clavier est supprimer d'un √©l√©ment accord√©on [<a href='https://checklists.opquast.com/fr/assurance-qualite-web/le-focus-clavier-nest-ni-supprime-ni-masque' target='_blank'>Opquast 160</a>]</li>");
				}
			});
			nia05l_node.focus();
		}
	}
	
	// M. Les styles ne justifient pas le texte.
	const nia05m_node = document.querySelector("p");
	if(nia05m_node && nia05m_node.style.textAlign == "justify"){
		setItemOutline(nia05m_node,"yellow","nia05m","05-M");
		setItemToResultList("nth","<li><a href='#' data-destination='nia05m' class='result-focus label-yellow'>05-M</a> : Pr√©sence de texte justifi√© [<a href='https://checklists.opquast.com/fr/assurance-qualite-web/les-styles-ne-justifient-pas-le-texte' target='_blank'>Opquast 186</a>]</li>");
	}
	
	// N. Les mises en majuscules √† des fins d√©coratives sont effectu√©es √† l'aide des styles.
	function isUpperCase (textInput) {  
	  return textInput === String(textInput).toUpperCase();
	}
	const nia05n_h1 = document.querySelector("h1");
	const nia05n_h2 = document.querySelector("h2");
	const nia05n_h3 = document.querySelector("h3");
	const nia05n_h4 = document.querySelector("h4");
	const nia05n_h5 = document.querySelector("h5");
	const nia05n_h6 = document.querySelector("h6");
	if(nia05n_h1 && isUpperCase(nia05n_h1)){
		setItemOutline(nia05n_h1,"yellow","nia05n1","05-N");
		setItemToResultList("nth","<li><a href='#' data-destination='nia05n1' class='result-focus label-yellow'>05-N</a> : Pr√©sence de titre H1 en majuscule [<a href='https://checklists.opquast.com/fr/assurance-qualite-web/les-mises-en-majuscules-a-des-fins-decoratives-sont-effectuees-a-laide-des-styles' target='_blank'>Opquast 187</a>]</li>");
	}
	if(nia05n_h2 && isUpperCase(nia05n_h2)){
		setItemOutline(nia05n_h2,"yellow","nia05n2","05-N");
		setItemToResultList("nth","<li><a href='#' data-destination='nia05n2' class='result-focus label-yellow'>05-N</a> : Pr√©sence de titre H2 en majuscule [<a href='https://checklists.opquast.com/fr/assurance-qualite-web/les-mises-en-majuscules-a-des-fins-decoratives-sont-effectuees-a-laide-des-styles' target='_blank'>Opquast 187</a>]</li>");
	}
	if(nia05n_h1 && isUpperCase(nia05n_h3)){
		setItemOutline(nia05n_h3,"yellow","nia05n3","05-N");
		setItemToResultList("nth","<li><a href='#' data-destination='nia05n3' class='result-focus label-yellow'>05-N</a> : Pr√©sence de titre H3 en majuscule [<a href='https://checklists.opquast.com/fr/assurance-qualite-web/les-mises-en-majuscules-a-des-fins-decoratives-sont-effectuees-a-laide-des-styles' target='_blank'>Opquast 187</a>]</li>");
	}
	if(nia05n_h1 && isUpperCase(nia05n_h4)){
		setItemOutline(nia05n_h4,"yellow","nia05n4","05-N");
		setItemToResultList("nth","<li><a href='#' data-destination='nia05n4' class='result-focus label-yellow'>05-N</a> : Pr√©sence de titre H4 en majuscule [<a href='https://checklists.opquast.com/fr/assurance-qualite-web/les-mises-en-majuscules-a-des-fins-decoratives-sont-effectuees-a-laide-des-styles' target='_blank'>Opquast 187</a>]</li>");
	}
	if(nia05n_h1 && isUpperCase(nia05n_h5)){
		setItemOutline(nia05n_h5,"yellow","nia05n5","05-N");
		setItemToResultList("nth","<li><a href='#' data-destination='nia05n5' class='result-focus label-yellow'>05-N</a> : Pr√©sence de titre H5 en majuscule [<a href='https://checklists.opquast.com/fr/assurance-qualite-web/les-mises-en-majuscules-a-des-fins-decoratives-sont-effectuees-a-laide-des-styles' target='_blank'>Opquast 187</a>]</li>");
	}
	if(nia05n_h1 && isUpperCase(nia05n_h6)){
		setItemOutline(nia05n_h6,"yellow","nia05n6","05-N");
		setItemToResultList("nth","<li><a href='#' data-destination='nia05n6' class='result-focus label-yellow'>05-N</a> : Pr√©sence de titre H6 en majuscule [<a href='https://checklists.opquast.com/fr/assurance-qualite-web/les-mises-en-majuscules-a-des-fins-decoratives-sont-effectuees-a-laide-des-styles' target='_blank'>Opquast 187</a>]</li>");
	}

	// O. La page des r√©sultats de recherche indique le nombre de r√©sultats
	if(!only_redactor){
		const nia05o_isSearch = document.getElementById("mainSearch");
		if(nia05o_isSearch){
			const nia05o_searchCount = document.querySelector(".search-meta-count");
			if(!nia05o_searchCount || !isItemVisible(nia05o_searchCount)){
				setItemToResultList("nc","<li><a href='#' data-destination='nia05o' class='result-focus label-red'>05-O</a> : La page des r√©sultats de recherche indique le nombre de r√©sultats [<a href='https://checklists.opquast.com/fr/assurance-qualite-web/la-page-des-resultats-de-recherche-indique-le-nombre-de-resultats-le-nombre-de-pages-de-resultats-et-le-nombre-de-resultats-par-page' target='_blank'>Opquast 13</a>]</li>");
				setItemsOutline(nia05o_isSearch,"red","nia05o","05-O");
			}
		}
	}
	
	// P. Section vide dans la page
	const nia05p_nodes = document.querySelectorAll('section.cmp-section');
	let nia05p_flag = false;
	let nia05p_clean_node = "", nia05p_container = "", nia05p_lang = "";
	if(nia05p_nodes && nia05p_nodes.length > 0){
		for(let i = 0; i < nia05p_nodes.length; i++){
			nia05p_lang = nia05p_nodes[i].closest('[lang]').getAttribute('lang');
			nia05p_clean_node = sanitizeText(nia05p_nodes[i].innerText, nia05p_lang);
			if(nia05p_clean_node == "" && isItemVisible(nia05p_nodes[i])){
				setItemOutline(nia05p_nodes[i],"yellow","nia05p","05-P");
				nia05p_container = nia05p_nodes[i].parentElement;
				nia05p_flag = true;
			}
		}
	}
	if(nia05p_flag == true) {
	  setItemToResultList("nth","<li><a href='#' data-destination='nia05p' class='result-focus label-yellow'>05-P</a> : Pr√©sence de section vides (ou avec un contenu assimilable √† vide) [<a href='https://accessibilite.public.lu/fr/raweb1/criteres.html#test-8-9-1' target='_blank'>RAWeb 8.9.1</a>]</li>");
	}
	
	// Q Logo
	/*
	Le lien sur le logo redirige vers la page d‚Äôaccueil et poss√®de un attribut title respectant la nomenclature suivante¬†: ¬´¬†[XXX] ‚Äì Accueil¬†¬ª
	Si du texte est pr√©sent sur le logo, possibilit√© de saisir un texte alt
	Si du texte r√©dig√© dans une langue √©tang√®re est pr√©sente sur le logo, possibilit√© de pr√©ciser une langue.
	Pas d'indication du mot "logo" dans le texte alt du logo
	*/
	const nia05q_nodes = document.querySelectorAll('header .logo');
	let nia05q_flag1 = false;
	let nia05q_flag2 = false;
	let nia05q_flag3 = false;
	let nia05q_flag4 = false;
	if(nia05q_nodes && nia05q_nodes.length > 0){
		for(let i = 0; i < nia05q_nodes.length; i++){
			
		}
	}
	
	// Y. TODO -->  Detect Overflow
	// https://stackoverflow.com/questions/143815/determine-if-an-html-elements-content-overflows
	// https://webtips.dev/webtips/javascript/find-overflowing-elements-with-javascript
	// https://www.stevefenton.co.uk/blog/2022/12/detect-overflowing-elements/
	
	// - Pr√©sence d‚Äôun attribut lang sur le <html>
	// - Pr√©sence d‚Äôun <title> pertinent (par rapport √† la Nomenclature : contient √† minimum [h1] [Nom du site] [Luxembourg])
}